/*
 * Copyright © 2020-2021 Metreeca srl
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

:root {

	--tool-page--color: var(--tool--color);
	--tool-page--background-color: var(--tool--background-color);

	--tool-page--header-box-shadow: 0 0 var(--tool-page--header-box-shadow-size) var(--tool-page--header-box-shadow-size);
	--tool-page--header-box-shadow-size: 0.75rem;

	--tool-page-tabs-color: #999;
	--tool-page-tabs-background-color: #FFF;

	--tool-page-pane-width: 15rem;
	--tool-page-pane-border-color: #DDD;
	--tool-page-pane-background-color: var(--tool--background-color-edit);

}

tool-page {

	display: block;

	position: relative;

	width: 100%;
	height: 100%;

	flex-shrink: 1;
	flex-grow: 1;

	overflow: hidden;

	color: var(--tool-page--color);
	background-color: var(--tool-page--background-color);

	&[disabled=true] {
		pointer-events: none;
		opacity: 0.66;
	}

	& > aside, & > main {

		display: flex;
		flex-direction: row;
		align-items: stretch;

		position: absolute;

		left: 0;
		right: 0;
		top: 0;
		bottom: 0;

		overflow: hidden;

		& > * {

			display: flex;
			flex-direction: column;
			align-items: stretch;

			overflow-x: hidden;
			overflow-y: auto;

			transform: scale(1); /* z-context */

			& > * {

				flex-shrink: 0;

				padding-left: 1rem;
				padding-right: 1rem;
			}

			& > header {

				z-index: 1;

				position: sticky;
				top: 0;

				display: flex;
				flex-direction: row;
				align-items: center;

				height: 4rem;

				white-space: nowrap;

				font-size: 1.5rem;

				& > :empty {

					flex-shrink: 0;

					display: block;

					width: 1em;
					height: 1em;

					background-size: contain;
					background-repeat: no-repeat;
					background-position: 50%;

				}

				& > input:only-child {
					flex-grow: 1;
				}

			}

			& > section {

				flex-grow: 1;

				position: relative; /* support absolute content positioning  */

				display: flex;
				flex-direction: column;
				align-items: stretch;

				padding-top: calc(2 * var(--tool-page--header-box-shadow-size));
				padding-bottom: 1rem;

				overflow-x: auto;

			}

			& > footer {

				display: flex;
				flex-direction: row;
				align-items: center;

				height: 4rem;

				& > * + * {
					margin-left: 0.25em;
				}

			}

		}

	}

	& > aside {

		white-space: nowrap;
		z-index: 1;

		background-color: rgba(0, 0, 0, 0.33); /* shadow main area */

		& > nav {

			flex-shrink: 0;

			border-right: solid 1px var(--tool-page-pane-border-color);

			color: var(--tool-page-tabs-color);
			background-color: var(--tool-page-tabs-background-color);

			& a {
				color: inherit;
			}

			& > * {
				font-size: 2.5rem; /* here to override generic header */
			}

			& > header {

				justify-content: center;

				box-shadow: var(--tool-page--header-box-shadow) var(--tool-page-tabs-background-color);

				& > * {
					flex-grow: 1;
				}

			}

			& > section {

				align-items: center;

				& > hr {

					align-self: stretch;

					margin-top: 1.5rem;
					margin-bottom: 1.5rem;

					&:last-child {
						display: none;
					}

				}

				& > *:not(hr) + *:not(hr) {
					margin-top: 0.5rem;
				}

			}

			& > footer {
				justify-content: center;
			}

		}

		& > div {

			width: var(--tool-page-pane-width);

			background-color: var(--tool-page-pane-background-color);

			& > header {
				box-shadow: var(--tool-page--header-box-shadow) var(--tool-page-pane-background-color);
			}

			& > section {
				font-size: 85%;
			}

			& > footer {
				color: #999;
			}

		}

	}

	& > main {

		& > div {

			flex-grow: 1;

			& > header {

				box-shadow: var(--tool-page--header-box-shadow) var(--tool-page--background-color);

				& > * {
					display: flex;
					flex-direction: row;
					align-items: center;
				}

				& > button {
					margin-right: 0.5em;
					font-size: 150%;
				}

				& > h1 {

					flex-grow: 1;


					& > * {
						overflow: hidden;
						text-overflow: ellipsis;
						font-weight: 500;
					}

					& > *:not(:first-child) {

						&::before {
							content: "›";
							padding: 0 0.25em;
						}

					}

					& > *:not(a):not(span) {
						flex-grow: 1;
					}

				}

				& > nav {

					flex-direction: row-reverse;

					& > * {

						margin-left: 0.25em;

						font-size: 110%;

					}

					& > a, & > button {
						color: inherit;
					}

					& > hr {
						display: none;
					}

					& > :not(:first-child):not(:last-child) {
						display: none;
					}

				}

			}

		}

	}


	@media only screen and (min-width: 640px) {

		& > aside {

			& > div {

				flex-shrink: 0;
				flex-grow: 0;

				border-right: solid 1px var(--tool-page-pane-border-color);
			}

		}

	}

	@media only screen and (min-width: 960px), print {

		display: flex;
		flex-direction: row;
		align-items: stretch;

		&.main > aside > div {
			display: none;
		}

		& > aside, & > main {

			position: relative;

			& > * {

				& > header {
					padding-top: 1rem;
				}

			}

		}


		& > aside {

			flex-shrink: 0;

			&.hide > div {
				display: none;
			}

			& > nav {

				--padding: 1.5rem;

				& > * {
					padding-left: var(--padding);
					padding-right: var(--padding);
				}

				& > header {

					& > :empty {
						transform: scale(1.1) translateY(5%);
					}

				}

			}

			& > div {

				& > * {
					padding-left: 1.5rem;
					padding-right: 1.5rem;
				}

			}

		}

		& > main {

			flex-grow: 1;

			& > div {

				& > * {
					padding-left: 2rem;
					padding-right: 1.5rem;
				}

				& > header {

					& > button {
						display: none;
					}

					& > nav {

						& > hr {

							border: none;

							margin-left: 0.5em;
							margin-right: 0.25em;

							&::after {
								content: '';
								border-left: solid 1px var(--tool-page-pane-border-color);
							}

						}

						& > :not(:first-child):not(:last-child) {
							display: block;
						}

						& > :last-child {
							display: none;
						}

					}

				}

			}

		}

	}

}